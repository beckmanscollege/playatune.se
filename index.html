<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Base styles for the page */
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;        /* Prevent scrolling */
      transition: background 1s ease;  /* Smooth transition when changing background */
    }

    /* For mobile screens */
    @media (max-width: 600px) {
      body {
        font-size: 14px;
      }
      canvas {
        width: 100%;
        height: auto;
      }
    }

    /* For tablets */
    @media (min-width: 601px) and (max-width: 1024px) {
      body {
        font-size: 16px;
      }
      canvas {
        width: 80%;
        height: auto;
      }
    }

    /* For desktop screens */
    @media (min-width: 1025px) {
      body {
        font-size: 18px;
      }
      canvas {
        width: 800px;
        height: 800px;
      }
    }

    /* Canvas style for positioning */
    canvas {
      position: absolute;   /* Absolute positioning */
      left: 50%;            /* Center horizontally */
      top: 50px;            /* Adjust top position (can be modified) */
      transform: translateX(-50%);  /* Offset by half of its width to center horizontally */
      background: transparent;  /* Make canvas background transparent */
    }
  </style>
</head>

<body>
  <div><canvas id="canvas"></canvas></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

  <script type="text/javascript">
    // 7 Predefined Gradients
    const gradients = [
      'radial-gradient(black, white)', // Black to white
      'radial-gradient(#000000, #1f00ff)', // Black to blue
      'radial-gradient(#9c051c, #ff008f)', // Red to pink : D
      'radial-gradient(#2d3a40, #838f8d)', // Pink to purple
      'radial-gradient(#1c2426, #a8b5ac)', // Grey to light grey
      'radial-gradient(#0a3040, #096b69)'  // Black to teal
    ];

    // Randomly choose a gradient from the array
    const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

    // Apply the selected gradient to the body's background
    document.body.style.background = randomGradient;

    // Sound assets
    const sound1 = new Audio('https://playatune.se/AssetsAssets/Violin1.mp3');
    const sound2 = new Audio('https://playatune.se/AssetsAssets/Violin2.mp3');
    const sound3 = new Audio('https://playatune.se/AssetsAssets/Violin3.mp3');
    const sound4 = new Audio('https://playatune.se/AssetsAssets/Violin4.mp3');
    const sound5 = new Audio('https://playatune.se/AssetsAssets/Violin5.mp3');
    
    const soundMap = [sound1, sound2, sound3, sound4, sound5];
    
    let currentSound = null; // The currently playing sound
    let fadeDuration = 500;  // Fade out duration in ms

    // Lissajous parameters
    let freqX = 4;
    let freqY = 7;
    let phi = 15;
    let modFreqX = 3;
    let modFreqY = 2;
    let lineWeight = 0.2;
    let lineColor; 
    let lineAlpha = 50;
    let connectionRadius = 100;
    let pointCount = 700;
    let lissajousPoints = [];

    var sketch = function(p) {
      p.setup = function() {
        // Adjust canvas size dynamically based on window size
        p.createCanvas(window.innerWidth * 0.8, window.innerHeight * 0.8);
        p.colorMode(p.RGB, 255, 255, 255, 100);
        p.noFill();
        lineColor = p.color(255, 50);
        calculateLissajousPoints();
        drawLissajous();
      };

      function calculateLissajousPoints() {
        lissajousPoints = [];
        for (let i = 0; i <= pointCount; i++) {
          let angle = p.map(i, 0, pointCount, 0, p.TAU);
          let x = p.sin(angle * freqX + p.radians(phi)) * p.cos(angle * modFreqX);
          let y = p.sin(angle * freqY) * p.cos(angle * modFreqY);
          x *= p.width / 2 - 30;
          y *= p.height / 2 - 30;
          lissajousPoints[i] = p.createVector(x, y);
        }
      }

      function drawLissajous() {
        p.clear();  // Use p5.js' clear() method to clear the canvas each frame (transparent background)
        p.strokeWeight(lineWeight);
        p.push();
        // Center the Lissajous figure in the middle of the canvas
        p.translate(p.width / 2, p.height / 2);

        for (let i1 = 0; i1 < pointCount; i1++) {
          for (let i2 = 0; i2 < i1; i2++) {
            let d = lissajousPoints[i1].dist(lissajousPoints[i2]);
            let a = p.pow(1 / (d / connectionRadius + 1), 6);
            if (d <= connectionRadius) {
              p.stroke(lineColor, a * lineAlpha);
              p.line(
                lissajousPoints[i1].x,
                lissajousPoints[i1].y,
                lissajousPoints[i2].x,
                lissajousPoints[i2].y
              );
            }
          }
        }
        p.pop();
      }

      p.draw = function() {
        phi += 0.1
        calculateLissajousPoints();
        drawLissajous();
      }

      p.mouseMoved = function() {
        // Control Lissajous parameters based on mouse position
        freqX = p.map(p.mouseX, 0, p.width, 1, 10);  // X position controls freqX
        freqY = p.map(p.mouseY, 0, p.height, 1, 10);  // Y position controls freqY
        phi = p.map(p.mouseX, 0, p.width, -180, 180);  // X position controls phase shift

        // Fade out the current sound and fade in the new sound
        if (currentSound) {
          fadeOut(currentSound);
        }

        // Select a new sound based on the X position of the mouse
        let soundIndex = p.int(p.map(p.mouseX, 0, p.width, 0, soundMap.length));

        // Set the new sound
        currentSound = soundMap[soundIndex];

        // Fade in the new sound
        fadeIn(currentSound);

        // Update Lissajous
        calculateLissajousPoints();
        drawLissajous();
      };

      function fadeOut(sound) {
        let fadeInterval = setInterval(() => {
          if (sound.volume > 0) {
            sound.volume -= 0.05;  // Decrease volume slowly
          } else {
            clearInterval(fadeInterval);
            sound.pause();  // Pause the sound once it's faded out completely
            sound.currentTime = 0;  // Reset the sound
          }
        }, fadeDuration / 10);
      }

      function fadeIn(sound) {
        sound.volume = 0;  // Start the new sound at 0 volume
        sound.play();
        
        let fadeInterval = setInterval(() => {
          if (sound.volume < 1) {
            sound.volume += 0.05;  // Increase volume slowly
          } else {
            clearInterval(fadeInterval);  // Stop the fade-in once full volume is reached
          }
        }, fadeDuration / 10);
      }

      // Re-adjust canvas size on window resize
      p.windowResized = function() {
        p.resizeCanvas(window.innerWidth * 0.8, window.innerHeight * 0.8);
        calculateLissajousPoints();
        drawLissajous();
      };
    };

    // Start p5 sketch
    new p5(sketch);
  </script>
</body>
</html>

